/* ===== Tokens ===== */
:root{
  --bg: #0b0d12;
  --panel: #0f1218;
  --elev: #131826;
  --card: #141a2b;
  --ink: #e8ecf3;
  --muted: #97a0b1;
  --brand: #6d67ff;
  --brand-2:#22c1a4;
  --danger:#ff5c6c;
  --ring: 0 0 0 2px color-mix(in oklab, var(--brand) 35%, transparent);
  --b1: 1px solid color-mix(in oklab, var(--ink) 10%, transparent);
  --radius: 14px;
  --r-sm: 10px;
  --shadow-1: 0 10px 30px rgba(0,0,0,.35), 0 2px 10px rgba(0,0,0,.25);
  --shadow-2: 0 18px 50px rgba(0,0,0,.45);
}

/* ===== Base ===== */
*{ box-sizing: border-box }
html,body{ height:100%; margin:0 }
body{
  font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
  color: var(--ink);
  background:
    radial-gradient(900px 500px at -10% -10%, color-mix(in oklab, var(--brand) 16%, transparent), transparent),
    radial-gradient(900px 500px at 110% -30%, color-mix(in oklab, var(--brand-2) 12%, transparent), transparent),
    var(--bg);
}

/* ===== Layout ===== */
.app{ display:grid; grid-template-rows: 56px 1fr; min-height:100dvh }
.topbar{
  display:flex; align-items:center; gap:16px; padding:0 16px;
  background: linear-gradient(180deg, color-mix(in oklab, var(--panel) 90%, transparent), transparent);
  border-bottom: var(--b1);
  position: sticky; top:0; z-index:20; backdrop-filter: blur(10px);
}
.brand{ display:flex; align-items:center; gap:8px; font-weight:700 }
.logo{ width:24px; height:24px; display:grid; place-items:center; color:var(--brand) }

.toolbar{ display:flex; align-items:center; gap:8px; flex:1 }
.divider{ width:1px; height:26px; background:color-mix(in oklab, var(--ink) 12%, transparent) }
.spacer{ flex:1 }
.zoom{ display:flex; align-items:center; gap:8px }
#zoom-level{ min-width:52px; text-align:center; color:var(--muted); font-weight:600 }

.shell{
  display:grid;
  grid-template-columns: 280px minmax(0,1fr) 320px;
  gap:16px;
  padding:16px;
}

/* ===== Rail (only dropzone now) ===== */
.rail{
  display:flex; flex-direction:column; gap:12px; position:sticky; top:72px; align-self:start; height: calc(100dvh - 72px);
}
.rail-foot{ margin-top:auto; display:grid; gap:10px }
.drop{
  display:grid; place-items:center; gap:6px; padding:14px; border:var(--b1); border-radius: var(--radius);
  background: linear-gradient(180deg, color-mix(in oklab, var(--card) 88%, transparent), transparent);
  cursor:pointer; text-align:center; position:relative;
}
.drop:focus{ outline: none; box-shadow: var(--ring) }
.drop input{ position:absolute; inset:0; opacity:0; cursor:pointer }
.drop-icon{ font-size:16px }
.drop-text{ font-weight:600 }
.muted{ color:var(--muted); font-size:12px }

/* ===== Canvas ===== */
.canvas{ display:flex; flex-direction:column; gap:12px }
.stage{
  position:relative; background: var(--panel); border: var(--b1); border-radius: var(--radius);
  min-height: clamp(300px, 60vh, 700px); box-shadow: var(--shadow-2);
  display:grid; place-items:center; overflow:hidden;
}
.stage-inner{
  position:relative; transform-origin:center; user-select:none;
  width: min(100%, 1600px); height: min(100%, 1000px);
}
.img-layer{ position:absolute; inset:0; width:100%; height:100%; object-fit:contain; background: var(--panel); transition: opacity .25s ease }
.img-layer:not([src]) { opacity: 0; pointer-events: none; }

/* before/after */
.ba-handle{
  position:absolute; top:0; bottom:0; left:50%; width:2px;
  background: color-mix(in oklab, var(--ink) 55%, transparent); z-index:3; display:grid; place-items:center;
  cursor: ew-resize;
}
.ba-handle .grip{
  width:28px; height:28px; border-radius:999px; background: var(--brand);
  box-shadow: 0 6px 18px color-mix(in oklab, var(--brand) 45%, transparent);
  outline: 3px solid color-mix(in oklab, var(--brand) 25%, transparent);
}
.ba-handle:focus { outline: none; box-shadow: none; }

/* empty */
.empty{ position:absolute; inset:0; display:grid; place-items:center; text-align:center; gap:6px; color:var(--muted); pointer-events:none }
.empty h3{ color: var(--ink); margin:.2rem 0 .1rem }
.empty-illustration{
  width:120px; height:80px; border-radius:12px; border:var(--b1); background:
    linear-gradient(180deg, color-mix(in oklab, var(--card) 88%, transparent), transparent);
  box-shadow: inset 0 0 0 2px color-mix(in oklab, var(--ink) 4%, transparent);
}
.stage.has-image .empty { display: none !important; }

/* loader */
.loader{
  position:absolute; top:12px; right:12px; width:46px; height:46px; border-radius:50%;
  border:6px solid color-mix(in oklab, var(--ink) 12%, transparent); border-top-color: var(--brand);
  animation: spin 1s linear infinite; background: transparent;
}

/* bottom bar */
.bottom-bar{
  display:flex; align-items:center; gap:10px; justify-content:space-between;
  border: var(--b1); border-radius: var(--r-sm); padding:10px 12px;
  background: linear-gradient(180deg, color-mix(in oklab, var(--card) 90%, transparent), transparent);
}
.status{ color: var(--muted); font-weight: 600 }

/* ===== Inspector ===== */
.inspector{
  display:flex; flex-direction:column; gap:12px; position:sticky; top:72px; height: calc(100dvh - 72px);
}
.panel{
  background: linear-gradient(180deg, color-mix(in oklab, var(--card) 90%, transparent), transparent);
  border: var(--b1); border-radius: var(--radius); padding:14px; box-shadow: var(--shadow-1)
}
.panel h3{ margin:0 0 10px 0; font-size:13px; color:var(--muted) }
.grid{ display:grid; gap:10px }
.field{ display:grid; gap:6px }
select, input[type="number"], input[type="range"]{
  width:100%; background: var(--elev); color: var(--ink); border: var(--b1); border-radius:10px; padding:10px 12px; accent-color: var(--brand)
}
.with-suffix{ position:relative }
.with-suffix .suffix{ position:absolute; right:10px; top:50%; transform:translateY(-50%); color:var(--muted); font-size:12px }
.check{ display:flex; align-items:center; gap:8px; font-weight:600 }
.actions{ margin-top:10px }
.w-full{ width:100% }

/* ===== Buttons ===== */
.btn{ background: var(--elev); color: var(--ink); border: var(--b1); border-radius:10px; padding:8px 12px; font-weight:700; cursor:pointer }
.btn:hover{ box-shadow: var(--shadow-1); transform: translateY(-1px); transition: .12s }
.btn.icon{ width:32px; padding:0; display:grid; place-items:center }
.btn-primary{ background: linear-gradient(180deg, color-mix(in oklab, var(--brand) 86%, transparent), color-mix(in oklab, var(--brand) 65%, transparent)); color:#fff; border-color: color-mix(in oklab, var(--brand) 30%, transparent) }
.btn-secondary{ background: var(--panel) }
.btn-ghost{ background: transparent }
.btn:focus{ outline:none; box-shadow: var(--ring) }

/* ===== Responsive ===== */
@media (max-width: 1100px){
  .shell{ grid-template-columns: 1fr; }
  .rail{ position:static; height:auto }
  .inspector{ position:static; height:auto }
}

/* ===== Misc ===== */
kbd{ background: var(--elev); border: var(--b1); padding:2px 6px; border-radius:6px; font-weight:700 }
@keyframes spin{ to{ transform: rotate(360deg) } }
